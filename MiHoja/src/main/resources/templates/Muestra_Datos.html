<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Datos de Hoja de Vida</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>

<!-- ‚úÖ NAVBAR -->
<div class="navbar">
    <div class="logo" href="/consultar">[Logo]</div>
    <div class="app-name" href="/consultar">MiHoja</div>
    <div class="nav-links">
        <a class="active" href="/consultar">Consultar</a>
        <a href="/insertar">Insertar</a>
    </div>
</div>

<!-- ‚úÖ ACCIONES SUPERIORES -->
<div class="acciones-superiores">
    <!-- üîô Bot√≥n para regresar manteniendo todos los filtros -->
    <div>
        <a th:href="@{'/consultar?' + ${filtrosQuery}}">
            <button class="cerrar-btn">X</button>
        </a>
    </div>

    <!-- üì• Men√∫ de descarga -->
    <div th:if="${persona != null}">
        <button class="descargar-btn" onclick="toggleMenu()">Descargar</button>
        <div class="descargar-menu" id="menuDescarga" style="display:none;">
            <a th:href="@{/api/descargar/{id}/pdf(id=${persona.id})}" target="_blank">PDF</a>
            <a th:href="@{/api/descargar/{id}/excel(id=${persona.id})}" target="_blank">Excel</a>
            <a th:href="@{/api/descargar/{id}/word(id=${persona.id})}" target="_blank">Word</a>
        </div>
    </div>
</div>

<!-- ‚úÖ DATOS DE LA PERSONA -->
<div class="datos-container" th:if="${persona != null}">
    <div class="fila">
        <div class="dato"><label>N¬∞</label>
            <div class="valor" th:text="${persona.numero}"></div>
        </div>
        <div class="dato"><label>Nombres</label>
            <div class="valor" th:text="${persona.nombres}"></div>
        </div>
        <div class="dato"><label>Apellidos</label>
            <div class="valor" th:text="${persona.apellidos}"></div>
        </div>
    </div>

    <div class="fila">
        <div class="dato"><label>C√©dula</label>
            <div class="valor" th:text="${persona.cedula}"></div>
        </div>
        <div class="dato"><label>Lugar de Expedici√≥n</label>
            <div class="valor" th:text="${persona.lugarExpedicion}"></div>
        </div>
        <div class="dato"><label>Fecha de Nacimiento</label>
            <div class="valor" th:text="${persona.fechaNacimiento}"></div>
        </div>
    </div>

        <div class="fila">
        <div class="dato"><label>Direcci√≥n</label>
            <div class="valor" th:text="${persona.direccion}"></div>
        </div>
        <div class="dato"><label>Sexo</label>
            <div class="valor" th:text="${persona.sexo}"></div>
        </div>
        <div class="dato"><label>Correo Institucional</label>
            <div class="valor" th:text="${persona.correoInstitucional}"></div>
        </div>
    </div>

    <div class="fila">
        <div class="dato"><label>Tel√©fono</label>
            <div class="valor" th:text="${persona.telefonoInstitucional}"></div>
        </div>
        <div class="dato" th:if="${formacion != null}">
            <label>Formaci√≥n Acad√©mica</label>
            <div class="valor" th:text="${formacion.formacionAcademica}"></div>
        </div>
        <div class="dato" th:if="${formacion != null}">
            <label>Grado</label>
            <div class="valor" th:text="${formacion.grado}"></div>
        </div>
    </div>

    <div class="fila">
        <div class="dato" th:if="${formacion != null}">
            <label>T√≠tulo</label>
            <div class="valor" th:text="${formacion.titulo}"></div>
        </div>
        <div class="dato" th:if="${cargoLaboral != null}">
            <label>C√≥digo</label>
            <div class="valor" th:text="${cargoLaboral.codigo}"></div>
        </div>
        <div class="dato" th:if="${cargoLaboral != null}">
            <label>Cargo</label>
            <div class="valor" th:text="${cargoLaboral.cargo}"></div>
        </div>
    </div>

    <div class="fila">
        <div class="dato" th:if="${cargoLaboral != null}">
            <label>Dependencia</label>
            <div class="valor" th:text="${cargoLaboral.dependencia}"></div>
        </div>
        <div class="dato" th:if="${pcl != null}">
            <label>Meses de Experiencia</label>
            <div class="valor" th:text="${pcl.mesesExperiencia}"></div>
        </div>
        <div class="dato" th:if="${pcl != null}">
            <label>Fecha de Ingreso</label>
            <div class="valor" th:text="${pcl.fechaIngreso}"></div>
        </div>
    </div>

    <div class="fila">
        <div class="dato" th:if="${induccionExamen != null}">
            <label>Fecha de Egreso</label>
            <div class="valor" th:text="${induccionExamen.fechaEgreso}"></div>
        </div>
        <div class="dato" th:if="${pcl != null}">
            <label>Fecha de Firma de Contrato</label>
            <div class="valor" th:text="${pcl.fechaFirmaContrato}"></div>
        </div>
        <div class="dato">
            <label>Enlace SIGEP</label>
            <div class="valor">
                <a th:if="${#strings.contains(persona.enlaceSigep, 'http')}"
                   th:href="${persona.enlaceSigep}" target="_blank" style="color:blue;"
                   th:text="${persona.enlaceSigep}"></a>
                <span th:unless="${#strings.contains(persona.enlaceSigep, 'http')}"
                      th:text="${persona.enlaceSigep}"></span>
            </div>
        </div>
    </div>

    <div class="fila" th:if="${salud != null}">
        <div class="dato"><label>Dotaci√≥n</label>
            <div class="valor" th:text="${salud.dotacion}"></div>
        </div>
        <div class="dato"><label>ARL</label>
            <div class="valor" th:text="${salud.arl}"></div>
        </div>
        <div class="dato"><label>EPS</label>
            <div class="valor" th:text="${salud.eps}"></div>
        </div>
    </div>

    <div class="fila" th:if="${salud != null}">
        <div class="dato"><label>AFP</label>
            <div class="valor" th:text="${salud.afp}"></div>
        </div>
        <div class="dato"><label>CCF</label>
            <div class="valor" th:text="${salud.ccf}"></div>
        </div>
        <div class="dato"><label>RH</label>
            <div class="valor" th:text="${salud.rh}"></div>
        </div>
    </div>

        <div class="fila" th:if="${salud != null}">
        <div class="dato"><label>Carnet de Vacunaci√≥n</label>
            <div class="valor" th:text="${salud.carnetVacunacion ? 'S√≠' : 'No'}"></div>
        </div>
        <div class="dato"><label>Enfermedades</label>
            <div class="valor">
                <ul th:if="${enfermedades != null and !enfermedades.isEmpty()}">
                    <li th:each="enf : ${enfermedades}" th:text="${enf}"></li>
                </ul>
                <span th:if="${enfermedades == null or enfermedades.isEmpty()}">N/A</span>
            </div>
        </div>
        <div class="dato"><label>Alergias</label>
            <div class="valor">
                <ul th:if="${alergias != null and !alergias.isEmpty()}">
                    <li th:each="ale : ${alergias}" th:text="${ale}"></li>
                </ul>
                <span th:if="${alergias == null or alergias.isEmpty()}">N/A</span>
            </div>
        </div>
    </div>

    <div class="fila">
        <div class="dato"><label>Medicamentos</label>
            <div class="valor">
                <ul th:if="${medicamentos != null and !medicamentos.isEmpty()}">
                    <li th:each="med : ${medicamentos}" th:text="${med}"></li>
                </ul>
                <span th:if="${medicamentos == null or medicamentos.isEmpty()}">N/A</span>
            </div>
        </div>
        <div class="dato" th:if="${induccionExamen != null}">
            <label>Examen de Ingreso</label>
            <div class="valor" th:text="${induccionExamen.examenIngreso}"></div>
        </div>
        <div class="dato" th:if="${induccionExamen != null}">
            <label>Inducci√≥n</label>
            <div class="valor" th:text="${induccionExamen.induccion}"></div>
        </div>
    </div>

    <div class="fila" th:if="${riesgoProcedencia != null}">
        <div class="dato">
            <label>Medio de Transporte</label>
            <div class="valor" th:text="${riesgoProcedencia.medioTransporte}"></div>
        </div>
        <div class="dato">
            <label>Procedencia del Trabajador</label>
            <div class="valor" th:text="${riesgoProcedencia.procedenciaTrabajador}"></div>
        </div>
        <div class="dato">
            <label>Riesgo</label>
            <div class="valor" th:text="${riesgoProcedencia.riesgo}"></div>
        </div>
    </div>

    <div class="fila" th:if="${contactoEmergencia != null}">
        <div class="dato">
            <label>En caso de Emergencia llamar a:</label>
            <div class="valor" th:text="${contactoEmergencia.nombreContactoEmergencia}"></div>
        </div>
        <div class="dato">
            <label>Parentesco</label>
            <div class="valor" th:text="${contactoEmergencia.parentesco}"></div>
        </div>
        <div class="dato">
            <label>Tel√©fono del Contacto</label>
            <div class="valor" th:text="${contactoEmergencia.telefonoContactoEmergencia}"></div>
        </div>
    </div>
</div>

<!-- ‚úÖ MENSAJE SI NO SE ENCUENTRA -->
<div th:if="${persona == null}" style="padding: 2rem; text-align: center;">
    <h2 style="color: red;">No se encontr√≥ la hoja de vida solicitada.</h2>
    <a th:href="@{/consultar(
        nombre=${param.nombre},
        formacion=${param.formacion},
        grado=${param.grado},
        cargo=${param.cargo},
        dependencia=${param.dependencia},
        mesesExperiencia=${param.mesesExperiencia},
        dotacion=${param.dotacion}
    )}">
        Volver a la b√∫squeda
    </a>
</div>

<!-- ‚úÖ SCRIPT PARA DESCARGA -->
<script>
    function toggleMenu() {
        const menu = document.getElementById("menuDescarga");
        menu.style.display = menu.style.display === "flex" ? "none" : "flex";
    }

    document.addEventListener('click', function (event) {
        const menu = document.getElementById("menuDescarga");
        const button = document.querySelector(".descargar-btn");
        if (!button.contains(event.target) && !menu.contains(event.target)) {
            menu.style.display = "none";
        }
    });
</script>

</body>
</html>
